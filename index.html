<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown from Google Sheets</title>
    <style>
        body { font-family: Arial, sans-serif; }
        select, div { margin-top: 10px; }
        .note-container { margin-top: 10px; }
        .note-item { display: flex; align-items: center; margin-bottom: 5px; }
        .note-item input { margin-right: 5px; }
        .help-icon {
            font-size: 16px;
            color: blue;
            cursor: pointer;
            margin-left: 8px;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <h2>Select a State and AHJ</h2>
    <label for="state">State:</label>
    <select id="state" onchange="updateAHJ()">
        <option value="">Select State</option>
    </select>

    <label for="ahj">AHJ:</label>
    <select id="ahj" onchange="displayNote()">
        <option value="">Select AHJ</option>
    </select>

    <h3>Notes:</h3>
    <div id="note-container" class="note-container"></div> <!-- Notes with checkboxes and help icons -->

    <script>
        const sheetUrl = "https://script.google.com/macros/s/AKfycbybzOh2zN4xH1IxnLUVW6vt_1uV7axwb2XZ-dBAr0pbhJhtV7-H2v23SEcPBYm3chjg/exec"; // Replace with your deployed script URL

        let allData = [];

        async function fetchData() {
            const response = await fetch(sheetUrl);
            const data = await response.json();
            allData = data;

            const states = [...new Set(data.map(item => item.state))];
            const stateDropdown = document.getElementById("state");

            states.forEach(state => {
                let option = document.createElement("option");
                option.value = state;
                option.textContent = state;
                stateDropdown.appendChild(option);
            });
        }

        function updateAHJ() {
            const selectedState = document.getElementById("state").value;
            const ahjDropdown = document.getElementById("ahj");

            ahjDropdown.innerHTML = '<option value="">Select AHJ</option>';

            const filteredAHJs = allData.filter(item => item.state === selectedState);

            filteredAHJs.forEach(item => {
                let option = document.createElement("option");
                option.value = item.ahj;
                option.textContent = item.ahj;
                ahjDropdown.appendChild(option);
            });
        }

        function displayNote() {
            const selectedAHJ = document.getElementById("ahj").value;
            const noteContainer = document.getElementById("note-container");

            noteContainer.innerHTML = ""; // Clear previous notes

            const foundData = allData.find(item => item.ahj === selectedAHJ);

            if (foundData && foundData.note) {
                let notesArray = foundData.note.split("&");

                notesArray.forEach(note => {
                    let trimmedNote = note.trim();

                    if (trimmedNote.toLowerCase().includes("for more details")) {
                        // Only show help icon, do not include this text in the checklist
                        let helpLink = document.createElement("a");
                        helpLink.href = "https://your-help-page.com"; // Replace with actual help page URL
                        helpLink.target = "_blank";
                        helpLink.className = "help-icon";
                        helpLink.innerHTML = " ℹ️"; // Info icon
                        noteContainer.appendChild(helpLink);
                    } else {
                        // Create normal checklist item
                        let noteItem = document.createElement("div");
                        noteItem.className = "note-item";

                        let checkbox = document.createElement("input");
                        checkbox.type = "checkbox";

                        let label = document.createElement("label");
                        label.textContent = trimmedNote;

                        noteItem.appendChild(checkbox);
                        noteItem.appendChild(label);

                        noteContainer.appendChild(noteItem);
                    }
                });
            }
        }

        fetchData();
    </script>

</body>
</html>
