<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State & AHJ Selector</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        select, #note { margin-top: 10px; padding: 8px; width: 200px; }
    </style>
</head>
<body>
    <h2>Dropdown Filter</h2>
    <label for="state">Select State:</label>
    <select id="state">
        <option value="">-- Choose State --</option>
    </select>

    <label for="ahj">Select AHJ:</label>
    <select id="ahj">
        <option value="">-- Choose AHJ --</option>
    </select>

    <p id="note"></p>

    <script>
        const sheetURL = "https://script.google.com/macros/s/AKfycbyO7LR0BQJyXzrld_dCtxYRW1usWuPDrcflr3YfCz3CBKSC-_zs3TncdvgfpyIP6HL-/exec"; 

        let stateDropdown = document.getElementById("state");
        let ahjDropdown = document.getElementById("ahj");
        let noteDisplay = document.getElementById("note");
        let data = [];

        async function fetchData() {
            const response = await fetch(sheetURL);
            data = await response.json();

            let states = [...new Set(data.map(row => row[0]))]; 
            states.forEach(state => {
                let option = document.createElement("option");
                option.value = state;
                option.textContent = state;
                stateDropdown.appendChild(option);
            });
        }

        stateDropdown.addEventListener("change", () => {
            let selectedState = stateDropdown.value;
            ahjDropdown.innerHTML = '<option value="">-- Choose AHJ --</option>';
            noteDisplay.textContent = ""; 

            let filteredAHJs = data.filter(row => row[0] === selectedState).map(row => row[1]);
            filteredAHJs.forEach(ahj => {
                let option = document.createElement("option");
                option.value = ahj;
                option.textContent = ahj;
                ahjDropdown.appendChild(option);
            });
        });

        ahjDropdown.addEventListener("change", () => {
            let selectedAHJ = ahjDropdown.value;
            let note = data.find(row => row[1] === selectedAHJ)?.[2] || "No note available";
            noteDisplay.textContent = `Note: ${note}`;
        });

        fetchData();
    </script>
</body>
</html>
